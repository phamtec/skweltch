<html>
<head>
	<title>Skwletch</title>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<link rel="stylesheet" href="main.css" />
	<script>
	$(function() {
		$( "#load" )
			.button()
			.click(function( event ) {
				$.ajax({
				  url: "/rest/load?file=machine.json",
				  cache: false
				}).done(function( html ) {
				});
				event.preventDefault();
			});
		$( "#nodes" )
			.button()
			.click(function( event ) {
				$.ajax({
				  url: "/rest/nodes",
				  cache: false
				}).done(function( html ) {
					var nodes = jQuery.parseJSON(html);
					var canvas = $("#graph")[0];
					var ctx = canvas.getContext("2d");
					
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					
					// place nodes
					for (n in nodes) {
						if (n  != "connections") {
							ctx.strokeRect(nodes[n].rect.left, nodes[n].rect.top, nodes[n].rect.width, nodes[n].rect.height);
							ctx.fillText(n, parseInt(nodes[n].rect.left)+16, parseInt(nodes[n].rect.top)+16);
							if ((typeof nodes[n].count) == "string" && parseInt(nodes[n].count) != 0) {
								ctx.fillText(nodes[n].count, parseInt(nodes[n].rect.left) + parseInt(nodes[n].rect.width) - 10, 
									parseInt(nodes[n].rect.top) - 5);
							}
						}
					}
					
					// draw connections
					var conn = nodes["connections"];
					for (n in conn) {
						var from = nodes[conn[n].from];
						var to = nodes[conn[n].to];
						if ((typeof to) == "object") {
							ctx.moveTo(parseInt(from.rect.left) + 50, parseInt(from.rect.top) + 50);
  							ctx.lineTo(parseInt(to.rect.left), parseInt(to.rect.top));
  							ctx.stroke();			
  							ctx.beginPath();
							ctx.arc(parseInt(to.rect.left), parseInt(to.rect.top), 5, 0, 2*Math.PI);
							ctx.stroke();
  						}
					}
				});
				event.preventDefault();
			});
	});
	</script>
</head>
<body>
<h3>Skweltch</h3>
<div>
	<button id="load">Load</button>
	<button id="nodes">Nodes</button>
</div>
<canvas id="graph" width="340px" height="340px"></canvas>
</body>
</html>
